{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹ë¬¼ ìƒë‹´ì†Œ ì±—ë´‡</title>
    <style>
        /* ê¸°ë³¸ ë¦¬ì…‹ & ê³µí†µ ì„¤ì • */
        *, *::before, *::after {
            box-sizing: border-box;
        }
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .chat-container {
            width: 100%;
            max-width: 820px;
            height: 80vh;
            max-height: 760px;
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.25);
            padding: 20px 22px;
            display: flex;
            flex-direction: column;
        }

        /* í—¤ë” ì˜ì—­ */
        .chat-header {
            text-align: center;
            margin-bottom: 10px;
        }
        .chat-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1565c0;
            margin: 0 0 6px 0;
        }
        .chat-subtitle {
            margin: 0;
            font-size: 0.9rem;
            color: #5c6bc0;
        }

        /* ì±„íŒ… ì°½ ì˜ì—­ */
        .chat-window {
            flex: 1;
            margin-top: 14px;
            border-radius: 16px;
            border: 1px solid #bbdefb;
            padding: 14px;
            background-color: #f5f9ff;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .message-group {
            display: flex;
            flex-direction: column;
            max-width: 80%;
        }

        .message-group--bot {
            align-self: flex-start;
        }

        .message-group--user {
            align-self: flex-end;
            text-align: right;
        }

        .message-meta {
            font-size: 0.78rem;
            color: #90a4ae;
            margin-bottom: 3px;
        }

        .message-bubble {
            padding: 9px 13px;
            border-radius: 16px;
            font-size: 0.94rem;
            line-height: 1.5;
            word-wrap: break-word;
            word-break: break-word;
        }

        .message-bubble--bot {
            background-color: #e3f2fd;
            color: #0d47a1;
            border-bottom-left-radius: 4px;
        }

        .message-bubble--user {
            background-color: #42a5f5;
            color: #ffffff;
            border-bottom-right-radius: 4px;
        }

        /* ì…ë ¥ ì˜ì—­ */
        .chat-form {
            margin-top: 14px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .plant-type {
            font-size: 0.88rem;
        }

        .plant-type-input {
            width: 100%;
            margin-top: 4px;
            padding: 8px 10px;
            border-radius: 10px;
            border: 1px solid #bbdefb;
            font-size: 0.9rem;
        }

        .input-row {
            display: flex;
            gap: 10px;
            margin-top: 2px;
        }

        .input-textarea {
            flex: 1;
            resize: none;
            border-radius: 12px;
            border: 1px solid #90caf9;
            padding: 10px;
            font-size: 0.94rem;
            height: 60px;
        }

        .input-submit {
            width: 120px;
            border: none;
            border-radius: 12px;
            background-color: #42a5f5;
            color: #ffffff;
            font-size: 0.94rem;
            cursor: pointer;
            transition: background-color 0.15s ease;
        }

        .input-submit:hover {
            background-color: #1e88e5;
        }

        /* ëª¨ë°”ì¼ ëŒ€ì‘ */
        @media (max-width: 600px) {
            .chat-container {
                height: 90vh;
                padding: 16px;
            }
            .chat-title {
                font-size: 1.2rem;
            }
            .message-group {
                max-width: 90%;
            }
            .input-submit {
                width: 90px;
                font-size: 0.88rem;
            }
        }
    </style>
</head>
<body>
<div class="chat-container">
    <header class="chat-header">
        <h1 class="chat-title">ğŸŒ¿ ì‹ë¬¼ ìƒë‹´ì†Œ ì±—ë´‡</h1>
        <p class="chat-subtitle">
            í‚¤ìš°ëŠ” ì‹ë¬¼ê³¼ ê³ ë¯¼ì„ ë§í•´ì£¼ë©´, ê¸°ë³¸ì ì¸ ê´€ë¦¬ íŒì„ ì•Œë ¤ì¤„ê²Œìš”.
        </p>
    </header>

    <section class="chat-window" id="chat-window">
        {% if messages %}
            {% for msg in messages %}
                <div class="message-group message-group--{{ msg.sender }}">
                    <div class="message-meta">
                        {{ msg.sender|upper }} Â· {{ msg.time }}
                    </div>
                    <div class="message-bubble message-bubble--{{ msg.sender }}">
                        {{ msg.text }}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="message-group message-group--bot">
                <div class="message-bubble message-bubble--bot">
                    ì•ˆë…•í•˜ì„¸ìš”! ì–´ë–¤ ì‹ë¬¼ì„ í‚¤ìš°ê³  ìˆë‚˜ìš”?<br>
                    ì ìƒ‰ ë³€í™”, ë¬¼ ì£¼ëŠ” ì£¼ê¸°, í–‡ë¹›/ì˜¨ë„ ê³ ë¯¼ì„ ììœ ë¡­ê²Œ ë¬¼ì–´ë³´ì„¸ìš”.
                </div>
            </div>
        {% endif %}
    </section>

    <form method="post" class="chat-form">
        {% csrf_token %}
        <div class="plant-type">
            <label for="plant_type">í‚¤ìš°ëŠ” ì‹ë¬¼</label>
            <input id="plant_type"
                   type="text"
                   name="plant_type"
                   class="plant-type-input"
                   placeholder="ì˜ˆ: ë¡œì¦ˆë§ˆë¦¬, ëª¬ìŠ¤í…Œë¼, ìŠ¤í‚¨ë‹µì„œìŠ¤"
                   value="{{ plant_type|default:'' }}">
        </div>

        <div class="input-row">
            <textarea name="user_message"
                      class="input-textarea"
                      placeholder="ì‹ë¬¼ ìƒíƒœë‚˜ ê³ ë¯¼ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”. ì˜ˆ: ì ëì´ ê°ˆìƒ‰ì´ê³  í™ì´ í•­ìƒ ì¶•ì¶•í•´ìš”."></textarea>
            <button type="submit" class="input-submit">ë³´ë‚´ê¸°</button>
        </div>
    </form>
</div>

<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì±„íŒ…ì°½ì„ ë§¨ ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤
    (function () {
        const chatWindow = document.getElementById('chat-window');
        if (chatWindow) {
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }
    })();
</script>
</body>
</html>
